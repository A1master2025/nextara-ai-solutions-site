---
/**
 * Thank-you page (Tier 2 submit success)
 * Route: /dcs-diagnostic/thank-you/
 * Fires: nt_dcs_diag_submit_success (tier2) with sessionStorage dedupe
 */
import Layout from "../../../layouts/Layout.astro";
import Tier2Telemetry from "../../../components/Tier2Telemetry.astro";
---

<Layout title="Thank You | DCS Diagnostic | NexTara">
  <Tier2Telemetry />

  <main data-nt-section="thank_you" data-nt-page="dcs_diagnostic_thank_you">
    <section class="thank-you-content">
      <h1>Thank You</h1>
      <p>Your DCS Diagnostic request has been received.</p>
      <p>We'll analyze your digital presence and send your personalized credibility report within 24â€“48 hours.</p>
      <a href="/" data-nt-event="cta_secondary" data-nt-cta="return_home">Return to Home</a>
    </section>

    <script is:inline>
      (function () {
        window.dataLayer = window.dataLayer || [];

        var SESSION_KEY = "nt_dcs_diag_submit_success_fired";
        var TIMEOUT_MS = 3000;
        var POLL_MS = 50;
        var elapsed = 0;

        function alreadyFired() {
          try { return sessionStorage.getItem(SESSION_KEY) === "1"; }
          catch (e) { return false; }
        }

        function markFired() {
          try { sessionStorage.setItem(SESSION_KEY, "1"); }
          catch (e) {}
        }

        function isSystemReady() {
          if (window.__NT_SYSTEM_READY_EMITTED__ === true) return true;
          try {
            for (var i = window.dataLayer.length - 1; i >= 0; i--) {
              if (window.dataLayer[i] && window.dataLayer[i].event === "nt_system_ready") return true;
            }
          } catch (e) {}
          return false;
        }

        function pushEvent() {
          if (alreadyFired()) return;
          markFired();
          window.dataLayer.push({
            event: "nt_dcs_diag_submit_success",
            nt_event_source: "tier2",
            form_name: "dcs-diagnostic",
            page_path: location.pathname,
            page_title: document.title
          });
        }

        function poll() {
          if (isSystemReady()) { pushEvent(); return; }
          if (elapsed < TIMEOUT_MS) { elapsed += POLL_MS; setTimeout(poll, POLL_MS); return; }
          // fail-open after 3000ms
          pushEvent();
        }

        poll();
      })();
    </script>
  </main>
</Layout>
