---
// src/pages/dcs-diagnostic/thank-you/index.astro
/**
 * Thank-you page (Tier 2 submit success)
 * Fires: nt_dcs_diag_submit_success (tier2) with session dedupe
 * No form on this page.
 */
import Layout from '../../layouts/Layout.astro';
---

<Layout>
  <main class="tier2-main" data-nt-page="dcs_diagnostic_thank_you">
    <section class="tier2-section">
      <div class="tier2-container">
        <h1 class="tier2-h1">Submission confirmed</h1>
        <p class="tier2-lead">We received your DCS Diagnostic request.</p>
        <p>You can close this tab or run another diagnostic.</p>
        <p style="margin-top: 12px;">
          <a class="tier2-btn" href="/dcs-diagnostic/">Run another diagnostic</a>
        </p>
      </div>
    </section>

    <script is:inline>
      (function () {
        window.dataLayer = window.dataLayer || [];

        // session dedupe
        var key = "nt_dcs_diag_submit_success";
        try {
          if (sessionStorage.getItem(key) === "1") return;
          sessionStorage.setItem(key, "1");
        } catch (e) {}

        var payload = {
          event: "nt_dcs_diag_submit_success",
          nt_event_source: "tier2",
          form_name: "dcs-diagnostic",
          page_path: "/dcs-diagnostic/thank-you/",
          page_title: "DCS Diagnostic Submitted"
        };

        // brief readiness wait, fail-open
        var start = Date.now();
        (function waitThenPush() {
          if (window.__NT_SYSTEM_READY_EMITTED__) return window.dataLayer.push(payload);
          if (Date.now() - start >= 3000) return window.dataLayer.push(payload);
          setTimeout(waitThenPush, 50);
        })();
      })();
    </script>
  </main>
</Layout>
